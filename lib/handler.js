/** * Created by lzq on 2017/11/6. * 匹配到给定 模式 的文件 会利用handlebars模版引擎对其进行渲染，输出到给定的路径下； */import handlebars from 'handlebars'import path from 'path'import metalsmith from 'metalsmith'/** @param {Object} context* @param {String} templateType* @param {String} outputDir* */function gh(context, templateType, outputDir){    return new Promise((resolve,reject)=>{        let dir = path.join(__dirname);       // console.log(dir)        // metalsmith()传入一个绝对路径        metalsmith(dir).source('../tmp').use(function(files, metalsmith, done){  // source默认值是 "./src"            Object.keys(files).forEach(function(key){                // 如此就可以将所有的模版中的js、json、vue文件进行处理了                if(/^template\/(.+\/)*(.+\.(js|json|vue))/.test(key)){   // template/package.json   template/config/index.js                    console.log(key);                    let htmldata = files[key].contents.toString();  // buffer转换为字符串                    console.log(key)                    // const context = {                    //     projectName:"yar",                    //     confirm:"lzq",                    //     choice: 'A'                    // };                    handlebars.registerHelper('lint',function(v1,options){                        if(v1 === 'yar'){                            options.inverse(this);  // 取消，不渲染                        }else{                            return options.fn(this);  // 确认，渲染                        }                    });                    let template = handlebars.compile(htmldata);                    let html = template(context);                    files[key].contents = new Buffer(html);                }            })            done();        }).build(function(err) {      // build process            console.log(err)            if (err) throw err;       // error handling is required        });    });};export default gh;